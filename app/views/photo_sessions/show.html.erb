<style>
  /*a         {color:<%= @photo_session.event.customer.color_three %>;}  
  a:visited {color:<%= @photo_session.event.customer.color_three %>;}  
  a:hover   {color:<%= @photo_session.event.customer.color_three %>;}  
  a:active  {color:<%= @photo_session.event.customer.color_three %>;} */

  /*<% if @event %>*/
  .color-one   {background-color: <%= @event.customer.color_one   %> !important;} 
  .color-two   {background-color: <%= @event.customer.color_two   %> !important;} 
  .color-three {color: <%= @event.customer.color_three %> !important;} 
  /*<% else %>*/
  .color-one   {background-color: <%= @photo_session.event.customer.color_one   %> !important;} 
  .color-two   {background-color: <%= @photo_session.event.customer.color_two   %> !important;} 
  .color-three {color: <%= @photo_session.event.customer.color_three %> !important;} 
  /*<% end %>*/

</style>

<!-- <div class="row">
  <ol class="breadcrumb col-md-12">
    <li><%= link_to 'Sessions', photo_sessions_path %></li>
    <li class="active"><%= @photo_session.id %></li>
  </ol>
</div>
 -->

<!-- <p>
  <strong>Name:</strong>
  <%= @photo_session.name %>
</p> -->

<!-- <p>
  <strong>Photo user:</strong>
  <%= @photo_session.photo_user_id %>
</p>
 -->
<!-- <p>
  <strong>Event:</strong>
  <%= @photo_session.event_id %>
</p> -->
<!-- 
<p>
  <strong>Phone Numbers:</strong>
  <%= label_tag :phone_list, @photo_session.phone_list.join(', ') %>  
</p> -->
<!-- 
<p>
  <strong>Emails:</strong>
  <%= label_tag :email_list, @photo_session.email_list.join(', ') %>  
</p>
 -->
<!-- <div> -->
<% if !@photo_session.photos.empty? %>

  
<br/>

<div class="container color-three">

  <div class=" text-center">
    <% if @photo_session.event.logo.file? %>
      <%= image_tag @photo_session.event.logo(:medium) %>  
    <% else %>
      <h2><%= @photo_session.event %></h2>
    <% end %>
  </div>
  
  <hr/>

  <div class="row">
  
  <% @photo_session.photos.each do |photo| %>
    <div class="col-sm-6 col-md-4">
       

       <div class="thumbnail color-two">
          <!-- <a href="<%= photo.url %>" target="_blank" title="<%= photo.image_file_name %>"> -->
            <%= image_tag(photo.image.url(:square), :width => '100%',  title: photo.image_file_name, style: 'pointer-events:none;')  %>
          <!-- </a> -->
          
          <button style="margin-top:5px;margin-bottom:5px;" type="button" class="btn btn-facebook btn-lg btn-block" onclick="openFacebookModal('<%=  photo.id %>');">
            <i class="fa fa-facebook"></i> Share to Facebook
          </button>

          <a id="share_twitter" href="https://twitter.com/intent/tweet?button_hashtag=FestPix&text=<%=u "#{@photo_session.event.twitter_text} #{photo.customer_url}" %>" target="_blank" title="Shared via @FestPix">
            <button style="margin-top:5px;" type="button" class="btn btn-twitter btn-lg btn-block" data-related="festpix" data-url="<%=  photo.image.url(:xlarge) %>">
              <i class="fa fa-twitter"></i> Share to Twitter
            </button>
          </a>

          <% if ENV['INSTAGRAM_ENABLED'].downcase == 'true' %>
            <button style="margin-top:5px;" type="button" class="btn btn-primary btn-lg btn-block" onclick="share_instagram('<%= photo.image.url(:medium) %>');">
              <i class="fa fa-instagram"></i> Download for Instagram
            </button>
          <% else %>
            <button style="margin-top:5px;" type="button" class="btn btn-primary btn-lg btn-block" onclick="window.location = '<%= photo.image.url(:xlarge) %>';">
              <i class="fa fa-floppy-o"></i> High-Res Download
            </button>
          <% end %>

         <!-- <a href="http://www.popsockets.com/pages/designer" target="_blank" title="PopSockets Store">
            <button style="margin-top:5px;" type="button" class="btn btn-twitter btn-lg btn-block" data-related="festpix" data-url="<#%  photo.image.url(:xlarge) %>">
              PopSockets Store
            </button>
          </a>-->
       </div>


    </div>
  <% end %>

  </div>


  <div class="row center">

    <div class="col-sm-4 col-md-4"></div>
    
    <div class="col-sm-4 col-md-4">
      <% if not @photo_session.event.button_url.nil? and not @photo_session.event.button_url.empty? %>
        <button type="button" class="btn btn-lg btn-block color-three" onclick="share_custom_button('<%=  @photo_session.event.button_url %>');">
            <%= @photo_session.event.button_text %>
        </button>
      <% end %>
    </div>

    <div class="col-sm-4 col-md-4"></div>
  </div>
  
  <div class="row center">

    <div class="col-sm-3 col-md-3"></div>
    
    <div class="col-sm-3 col-md-3">
      <% unless @photo_session.event.facebook_url.empty? %>
        <%= link_to  @photo_session.event.facebook_url, type: 'button', class: 'btn btn-lg btn-block color-one color-three' do %>
          <%= @photo_session.event.customer.name %> <i class="fa fa-facebook"></i>
        <% end %>
      <% end %>
    </div>
    <div class="col-sm-3 col-md-3">
      <% unless @photo_session.event.twitter_url.empty? %>
        <%= link_to  @photo_session.event.twitter_url, type: 'button', class: 'btn btn-lg btn-block color-one color-three' do %>
          <%= @photo_session.event.customer.name %> <i class="fa fa-twitter"></i>
        <% end %>
      <% end %>
    </div>

    <div class="col-sm-3 col-md-3"></div>
  </div>

  <div class="row center">

    <div class="col-sm-4 col-md-4"></div>
    
    <div class="col-sm-4 col-md-4">
      <% unless @photo_session.event.festpix? %>
        <div class="row center">
          <%= link_to 'http://festpix.com/', type: 'button', class: 'btn btn-lg btn-block color-one color-three' do %>
            FestPix
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="col-sm-4 col-md-4"></div>
  </div>

  

<!--   
  <hr/>
  <div class="col-md-12 well">
    <h3>Thanks so much for your support!</h3>
    <h4>In the mean time, subscribe to our email list if you'd like to stay up to date:</h4>
    <form action="http://festpix.us8.list-manage.com/subscribe/post?u=793783d1eb67229d5b27248ac&amp;id=2f2c08dbaa" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
        
      <div class="mc-field-group">
        <input value="" name="EMAIL" class="required email form-control" placeholder="Email" id="mce-EMAIL" type="email">
        <input value="Subscribe for Updates" name="subscribe" id="mc-embedded-subscribe" class="btn btn-primary" type="submit">
        <div id="mce-responses" class="clear">
          <div class="response" id="mce-error-response" style="display:none"></div>
          <div class="response" id="mce-success-response" style="display:none"></div>
        </div>    

        <div style="position: absolute; left: -5000px;"><input name="b_793783d1eb67229d5b27248ac_2f2c08dbaa" value="" type="text"></div>
      
        <h5 class="pull-right">Inquiries: <a href="mailto:info@festpix.com">info@FestPix.com</a></h5><br>
      </div>
    </form>
  </div> 
-->



<% else %>
  No Images Found
<% end %>


</div>


<%#= button_to 'Edit', edit_photo_session_path(@photo_session) %>
<%#= link_to 'Back', photo_sessions_path %>

<div class="modal fade bs-example-modal-sm" id="facebookSpinner" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="facebookSpinner">Sharing with Facebook</h4>
      </div>
      <%= image_tag 'loading.gif' , width: '100%' %>
    </div>
  </div>
</div>


<!-- <div class="modal fade" tabindex="-1" id="facebookStatus" role="dialog" aria-labelledby="facebookStatus" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
    </div>
  </div>
</div> -->


<div class="modal fade" id="facebookStatus" tabindex="-1" role="dialog" aria-labelledby="facebookStatus" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="facebookStatus">Facebook Share Successful</h4>
      </div>

      <div class="model-content text-center">
        <br /><br />
        <div id="facebookStatusMessage"></div>
        <br /><br />
      </div>
      
    </div>
  </div>
</div>


<div id="fb-root"></div>
<div id="facebook_share"></div>







<!-- ################ -->
<script type="text/javascript">

///////////////////////////////////////////////////////////////////////////
// Clickable links
$( '.clickable' ).on( "click", function() {
    window.location = $(this).attr('data-url');
});

///////////////////////////////////////////////////////////////////////////
// General sharing ajax
function share_social(social){
  $.ajax({
      url: "<%= photo_session_social_share_path(@photo_session) %>",
      type: "POST",
      data: { social_type: social },
      success: function(resp){ console.log('Successful share'); },
      error:   function(resp){ console.log("Social Share Error:"); console.log(resp); }
  });
}
///////////////////////////////////////////////////////////////////////////
// Custom Button Sharing
function share_custom_button(redirect_to){
  share_social('custom_button');
  if(redirect_to.length > 0) window.location = redirect_to;
}
///////////////////////////////////////////////////////////////////////////
// Twitter
function share_twitter(){
  share_social('twitter');
}
$('#share_twitter').click(function(e){
    e.preventDefault();
    var href = $(this).attr("href");

    share_twitter();

    window.location = href;
});
///////////////////////////////////////////////////////////////////////////
// Instagram
function share_instagram(redirect_to){
  share_social('instagram');
  if(redirect_to.length > 0) window.location = redirect_to;
}
///////////////////////////////////////////////////////////////////////////
// Facebook
function share_facebook(){
  share_social('facebook');
}
</script>
<!-- ################################################## -->







<!-- ################################################## -->
<script type="text/javascript">

function openFacebookModal(photo_id){
  $.ajax({
      url: "/social/facebook/share/"+photo_id,
      type: "GET",
      success: function(resp){ $('#facebook_share').html(resp); },
      error:   function(resp){ console.log(resp); }
  });
}

function alertFacebookPost(post_id){
  setTimeout(function() { 
    var post_data = post_id.split('_'); 
    var link = 'https://www.facebook.com/'+post_data[0]+'/posts/'+post_data[1];
    // pushFlash({message: 'Facebook share success. <a href="'+link+'"> View post here.</a>', state:'success'});

    $('#facebookStatus').modal('show');
    $('#facebookStatusMessage').prepend(
      $('<button/>')
        .text('View post here')
        .addClass('btn btn-primary btn-lg')
        .click(function () { window.location = link; })
    );
    
    setTimeout(function() {
      $('#facebookStatus').modal('hide');
    },5000);

  } , 500);

  
}

function shareToFacebook(reference, textMessage){
  console.log("Sharing "+ reference);

  if(!textMessage)
    textMessage = "<%= "#{@photo_session.event.facebook_text} #FestPix" %>";


    <% if ENV['FACEBOOK_POST_VERSION'].downcase == 'v1' %>

      $('#facebookSpinner').modal('show');

      FB.login(function(response){
   
        //v1
        FB.api( 
          '/me/photos', 'post', 
          {url: reference,message: textMessage}, 
          function(response){
            if(!response.id){
              console.log("Error");
              alertFacebookPost(response.post_id);
            } else {
              share_facebook();
            }

            $('#facebookSpinner').modal('hide');

        });
      }, {scope: 'publish_actions'});

    <% end %>

    <% if ENV['FACEBOOK_POST_VERSION'].downcase == 'v2' %>

      //v2
      FB.login(function(response){      
        FB.ui({
          method: 'feed',
          name: '<%= "#{@photo_session.event.customer} - #{@photo_session.event}" %>',
          link: reference,
          picture: reference,
          caption: 'Shared via #FestPix',
          description: textMessage
        }, function(response){
          if(response){
            share_facebook();
            alertFacebookPost(response.post_id);
          } else {
            console.log('Error!!');
          }
        });
      }, {scope: 'publish_actions'});

    <% end %>

    <% if ENV['FACEBOOK_POST_VERSION'].downcase == 'v3' %>

      //v3
      $('#facebookModal').modal('hide');

      FB.login(function(response){
      
        FB.api( 
          '/me/photos', 'post', 
          {url: reference,message: textMessage },
        function(response){
          if(response.id){
            share_facebook();
            alertFacebookPost(response.post_id);
          } else {
            console.log("Error");
          }

        });

      }, {scope: 'publish_actions'});
    <% end %>

}
</script>
<!-- ################################################## -->